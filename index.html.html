<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Monitoring Isu Viral | Intel & Humas</title>

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
    background: linear-gradient(135deg, #000, #111);
}
.gold { color:#d4af37; }
.gold-border { border:1px solid #d4af37; }
</style>
</head>

<body class="min-h-screen flex justify-center p-6 text-gray-200">

<div class="w-full max-w-3xl bg-[#0f0f0f] rounded-2xl shadow-2xl gold-border">

<!-- HEADER -->
<div class="p-6 border-b gold-border flex items-center">
    <div class="font-black text-lg gold">HUMAS / INTEL</div>
    <div class="ml-auto text-right">
        <div class="text-2xl font-black gold">MONITORING ISU VIRAL</div>
        <div class="text-xs text-gray-400 tracking-widest">
            ONLINE SYSTEM
        </div>
    </div>
</div>

<!-- FORM -->
<div class="p-6 space-y-4">

<div>
<label class="text-xs gold font-bold uppercase">Jenis Laporan</label>
<select id="jenisLaporan"
class="w-full mt-1 bg-black gold-border rounded-xl p-3 outline-none">
<option value="">-- Pilih Jenis Laporan --</option>
<option value="mabes">Laporan Viral Mabes (Intel)</option>
<option value="uka">Laporan Viral Uka-Uka (Humas)</option>
</select>
</div>

<div>
<label class="text-xs gold font-bold uppercase">Tempel Link Viral</label>
<textarea id="inputLink" rows="6"
class="w-full mt-1 bg-black gold-border rounded-xl p-3 font-mono text-sm outline-none"
placeholder="Tempel semua link di sini..."></textarea>
</div>

<button onclick="scanData()"
class="w-full py-4 rounded-xl bg-gradient-to-r from-yellow-700 to-yellow-500 text-black font-black tracking-widest">
SCAN & REKAP DATA
</button>

</div>

<!-- HASIL -->
<div class="p-6 border-t gold-border">
<div class="flex justify-between items-center mb-3">
<div class="gold font-black text-lg">HASIL REKAPITULASI</div>
<button onclick="exportPDF()"
class="bg-red-700 px-4 py-2 rounded text-xs font-bold">
UNDUH PDF
</button>
</div>

<div id="hasil" class="text-sm text-gray-300 italic">
Belum ada data.
</div>
</div>

</div>

<script>
let hasilData = {};

function scanData() {
    const teks = document.getElementById("inputLink").value.trim();
    const jenis = document.getElementById("jenisLaporan").value;

    if (!jenis) {
        alert("Pilih jenis laporan terlebih dahulu");
        return;
    }
    if (!teks) {
        alert("Masukkan link terlebih dahulu");
        return;
    }

    hasilData = {};
    const regex = /\b((https?:\/\/)?(www\.)?([a-z0-9-]+\.)+[a-z]{2,})(\/[^\s]*)?/gi;
    const links = teks.match(regex) || [];

    links.forEach(link => {
        let clean = link.toLowerCase()
            .replace(/^https?:\/\//,'')
            .replace(/^www\./,'')
            .replace(/[.,;!?]+$/,'');

        let domain = clean.split('/')[0];
        if (!hasilData[domain]) hasilData[domain] = new Set();
        hasilData[domain].add(clean);
    });

    renderHasil();
}

function renderHasil() {
    let html = "";
    Object.keys(hasilData).forEach(domain => {
        const list = Array.from(hasilData[domain]);
        html += `<div class="mb-3">
            <div class="gold font-bold">Jumlah ${domain} : ${list.length}</div>
            <ol class="list-decimal ml-6">`;
        list.forEach(l => html += `<li>${l}</li>`);
        html += `</ol></div>`;
    });
    document.getElementById("hasil").innerHTML = html || "Tidak ada link terdeteksi.";
}

function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const jenis = document.getElementById("jenisLaporan").value;
    const tanggal = new Date().toLocaleDateString("id-ID");

    let y = 15;

    if (jenis === "mabes") {
        doc.setFontSize(14);
        doc.text("LAPORAN HASIL MONITORING MEDIA SOSIAL", 105, y, {align:"center"});
        y += 8;
        doc.setFontSize(10);
        doc.text("SIFAT : TERBATAS", 14, y); y += 6;
    } else {
        doc.setFontSize(14);
        doc.text("LAPORAN MONITORING ISU VIRAL", 105, y, {align:"center"});
        y += 8;
    }

    doc.setFontSize(10);
    doc.text("Tanggal : " + tanggal, 14, y);
    y += 8;

    Object.keys(hasilData).forEach(domain => {
        doc.text(`Jumlah ${domain} : ${hasilData[domain].size}`, 14, y);
        y += 6;
        hasilData[domain].forEach(l => {
            doc.text("- " + l, 18, y);
            y += 5;
        });
        y += 4;
    });

    doc.save("Laporan_Monitoring_Isu_Viral.pdf");
}
</script>

</body>
</html>
